---
title: "Analysis of Spiny lobster abundance, community size structure, and fishing pressure along the Santa Barbara coast (2012-2018)"
author: "Jon Hart & Wes Newbury"
date: "11/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 13, fig.height = 10)
```
### Introduction

![](California-Spiny-Lobster.jpg){width=400px} 

**Figure 1.** California Spiny Lobster *(Credit: [Catalina Island Marine Institute](https://cimioutdoored.org/ca-spiny-lobster/))*

![](lobster_site_locations.PNG){width=500px}

**Figure 2.** The five sampling locations *(Credit: [EDI Data Portal](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=77&revision=newest))*

### Data and Methods



### Results
```{r, include =FALSE}
# Attach packages

library(tidyverse)
library(janitor)
library(here)
library(kableExtra)
library(knitr)
library(effsize)
```



```{r}
# Read in data and do some basic cleaning

lobster_abundance <- read_csv("lobster_abundance_sbc_lter.csv",
  na = "-99999") %>% 
  clean_names() 

lobster_data_tidy <- lobster_abundance %>% 
  uncount(count)
```


```{r}
# Wrangle data for lobster count per year/site

lobster_count_year <- lobster_abundance %>% 
  group_by(year, site) %>% 
  summarize(total_count_site = sum(count, na.rm = TRUE)) %>% 
  mutate(mpa = case_when(
    site %in% c("IVEE", "NAPL") ~ "Site within Marine Protected Area",
    site %in% c("AQUE", "MOHK", "CARP") ~ "Site outside Marine Protected Area")) %>%   mutate(site_name = case_when(
    site == "IVEE" ~ "4) Isla Vista",
    site == "NAPL" ~ "5) Naples",  
    site == "AQUE" ~ "1) Arroyo Quemado",
    site == "MOHK" ~ "3) Mohawk",
    site == "CARP" ~ "2) Carpenteria")) 
```



```{r}
# Graph annual lobster counts by site for 2012-2018

ggplot(data = lobster_count_year, aes(x = year, 
                                      y = total_count_site)) +
  geom_line(aes(color = mpa), 
                size = 1.5,
                show.legend = TRUE) + 
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(2012, 2018, by = 1),
                     limits = c(2011.5, 2018.5),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0, 900, by = 150),
                     expand = c(0,0),
                     limits = c(0, 1000)) +
  theme_bw() +
  facet_wrap(~site_name, 
             nrow = 2,
             scales= "free_x") +
  labs(x = "Year",
       y = "Lobster Count",
       title = "Lobster Counts by Kelp Forest Study Site",
       subtitle = "2012 - 2018",
       caption = "Figure 3. Annual lobster counts for each of the five sampling locations from 2012-2018. Isla Vista and Naples sites are within a Marine Protected Area while Carpenteria, Mohawk, and Arroyo sites are outside an MPA.") +
  theme(axis.text.x = element_text(angle= 90, 
                                   hjust = 1)) +
  theme(panel.grid.major = element_line(size = 1),
        legend.position = c(.85,.25),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 15)) 
        

```

```{r}
# Wrangle data for lobster size distribution graph

lobster_size_site <- lobster_data_tidy %>% 
  filter(year %in% c(2012, 2018)) %>% 
  select(year, site, size_mm) %>% 
  group_by(year, site)
  
```

```{r}
# Part B Graph


```




```{r}
# Initial data wrangling for lobster site statistical analysis

lobster_stats_tidy <- lobster_data_tidy %>% 
  mutate(mpa = case_when(
    site %in% c("IVEE", "NAPL") ~ "MPA",
    site %in% c("AQUE", "MOHK", "CARP") ~ "non-MPA")) %>%   
  filter(year %in% c(2012, 2018)) %>% 
  select(year, site, size_mm, mpa) %>% 
  group_by(year, mpa)  

```

```{r}
# Create statistical analysis data frames

mpa_2012 <- lobster_stats_tidy %>% 
  filter(year == 2012, mpa == "MPA") 

nonmpa_2012 <- lobster_stats_tidy %>% 
  filter(year == 2012, mpa == "non-MPA") 

mpa_2018 <- lobster_stats_tidy %>% 
  filter(year == 2018, mpa == "MPA") 

nonmpa_2018 <- lobster_stats_tidy %>% 
  filter(year == 2018, mpa == "non-MPA") 

# Calculate Means
mean_mpa_2012 <- mean(mpa_2012$size_mm, na.rm = TRUE) 
mean_nonmpa_2012 <- mean(nonmpa_2012$size_mm, na.rm = TRUE)
mean_mpa_2018 <- mean(mpa_2018$size_mm, na.rm = TRUE)
mean_nonmpa_2018 <- mean(nonmpa_2018$size_mm, na.rm = TRUE)

# Calculate Standard Deviations
sd_mpa_2012 <- sd(mpa_2012$size_mm, na.rm = TRUE) 
sd_nonmpa_2012 <- sd(nonmpa_2012$size_mm, na.rm = TRUE)
sd_mpa_2018 <- sd(mpa_2018$size_mm, na.rm = TRUE)
sd_nonmpa_2018 <- sd(nonmpa_2018$size_mm, na.rm = TRUE)

# Calculate Sample Sizes
n_mpa_2012 <- sum(!is.na(mpa_2012$size_mm))
n_nonmpa_2012 <- sum(!is.na(nonmpa_2012$size_mm))
n_mpa_2018 <- sum(!is.na(mpa_2018$size_mm))
n_nonmpa_2018 <- sum(!is.na(nonmpa_2018$size_mm))

# Wrangle data for statistics summary table
lobster_summary_table <- lobster_stats_tidy %>% 
  summarize(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size = sd(size_mm, na.rm = TRUE),
            sample_n = n()) %>% 
  mutate_if(is.numeric, round, 2) 
  
```


```{r}
# Make a table for lobster size sample statistics:

lobster_summary_table %>% 
  kable(col.names = c("Year", 
                     "MPA or non-MPA Sites", 
                     "Mean lobster size (mm)",
                     "Standard Deviation (mm)",
                     "Sample Size (# of lobsters)"),
        caption = "Figure 4. Lobster size statistics grouped in MPA and non-MPA sites in 2012 and 2018."
        ) %>% 
  kable_styling(bootstrap_options = c("striped", "bordered"),
                full_width = F,
                position = "center") %>% 
  row_spec(c(1,3), 
           bold = T) 
 
```



```{r}
# 1. For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

lobster_2012_mpa <- lobster_stats_tidy %>% 
  filter(year == 2012, mpa == "MPA") %>% 
  pull(size_mm)

lobster_2012_nonmpa <- lobster_stats_tidy %>% 
  filter(year == 2012, mpa == "non-MPA") %>% 
  pull(size_mm) 

lobster_2012_ttest <- t.test(lobster_2012_mpa, lobster_2012_nonmpa)

d_2012 <- cohen.d(lobster_2012_mpa, lobster_2012_nonmpa) #Cohen D 2012
```


Mean lobster size in MPA sites sampled in 2012 (`r round(mean_mpa_2012, 2)` $\pm$ `r round(sd_mpa_2012, 2)`, n = `r n_mpa_2012`) differed significantly from mean lobster size in non-MPA sites in 2012 (`r round(mean_nonmpa_2012, 2)` $\pm$ `r round(sd_nonmpa_2012, 2)`, n = `r n_nonmpa_2012`) by a two-sided, two sample t-test (t(`r round(lobster_2012_ttest$parameter, 2)`) = `r round(lobster_2012_ttest$statistic, 2)`, *p* < 0.01). In addition, there is a medium effect size (Cohen's *d* = `r round(d_2012$estimate, 2)`).


```{r}
# 2. For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

lobster_2018_mpa <- lobster_stats_tidy %>% 
  filter(year == 2018, mpa == "MPA") %>% 
  pull(size_mm)

lobster_2018_nonmpa <- lobster_stats_tidy %>% 
  filter(year == 2018, mpa == "non-MPA") %>% 
  pull(size_mm)

lobster_2018_ttest <- t.test(lobster_2018_mpa, lobster_2018_nonmpa)

d_2018  <- cohen.d(lobster_2018_mpa, lobster_2018_nonmpa) #Cohen D 2018

```

Mean lobster size in MPA sites sampled in 2018 (`r round(mean_mpa_2018, 2)` $\pm$ `r round(sd_mpa_2018, 2)`, n = `r n_mpa_2018`) differed significantly from mean lobster size in non-MPA sites in 2018 (`r round(mean_nonmpa_2018, 2)` $\pm$ `r round(sd_nonmpa_2018, 2)`, n = `r n_nonmpa_2012`) by a two-sided, two sample t-test (t(`r round(lobster_2018_ttest$parameter, 2)`) = `r round(lobster_2018_ttest$statistic, 2)`, *p* < 0.001). However, the effect size is fairly small (Cohen's *d* = `r round(d_2018$estimate, 2)`).


```{r}
# 3. For MPA sites only, is there a significant difference in lobsters observed in 2012 vs. 2018?

mpa_2012_2018_ttest <- t.test(lobster_2012_mpa, lobster_2018_mpa)

d_12_18_mpa <- cohen.d(lobster_2012_mpa, lobster_2018_mpa) # Cohen D 2012 vs. 2018 MPA

```

Mean lobster size differed significantly between MPA and non-MPA sites in 2018 for the sites sampled (t(`r round(mpa_2012_2018_ttest$parameter, 2)`) = `r round(mpa_2012_2018_ttest$statistic, 2)`, *p* < 0.001) with a large effect size (Cohen's *d* = `r round(d_12_18_mpa$estimate, 2)`).

```{r}
# 4. For non-MPA sites only, is there a significant difference in lobsters observed in 2012 vs. 2018?

nonmpa_2012_2018_ttest <- t.test(lobster_2012_nonmpa, lobster_2018_nonmpa)

d_12_18_nonmpa <- cohen.d(lobster_2012_nonmpa, lobster_2018_nonmpa) # Cohen D 2012 vs. 2018 non-MPA

```

There is not enough evidence to conclude that mean lobster size was significantly different in non-MPA sites in 2012 vs. 2018 (t(`r round(nonmpa_2012_2018_ttest$parameter, 2)`) = `r round(nonmpa_2012_2018_ttest$statistic, 2)`, *p* > 0.05) In addition, the effect size was negligible (Cohen's *d* = `r round(d_12_18_nonmpa$estimate, 2)`).


### Summary


### References 

**Reed D. 2019.** SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 10/30/2019.


